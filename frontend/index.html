<!DOCTYPE html>
<html>
<head>
    <title>Student Management</title>
    <script>
        async function fetchStudents() {
            let res = await fetch('http://localhost:5000/students');
            let students = await res.json();
            displayStudents(students);
        }

        function displayStudents(students) {
            let studentList = document.getElementById('studentList');
            let message = document.getElementById('noResults');
            
            if (students.length === 0) {
                studentList.innerHTML = '';
                message.textContent = 'ไม่มีข้อมูล';
            } else {
                studentList.innerHTML = students.map(s => 
                    `<li>${s.name} - ${s.major} 
                        <button onclick="editStudent('${s._id}', '${s.name}', ${s.age}, '${s.major}')">Edit</button>
                    </li>`).join('');
                message.textContent = '';
            }
        }

        async function addStudent() {
            let name = document.getElementById('name').value;
            let age = document.getElementById('age').value;
            let major = document.getElementById('major').value;
            
            await fetch('http://localhost:5000/students', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, age, major })
            });
            
            fetchStudents();
        }
        
        function editStudent(id, name, age, major) {
            document.getElementById('name').value = name;
            document.getElementById('age').value = age;
            document.getElementById('major').value = major;
            document.getElementById('submitBtn').setAttribute('onclick', `updateStudent('${id}')`);
        }
        
        async function updateStudent(id) {
            let name = document.getElementById('name').value;
            let age = document.getElementById('age').value;
            let major = document.getElementById('major').value;
            
            await fetch(`http://localhost:5000/students/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, age, major })
            });
            
            fetchStudents();
        }
        
        async function searchStudent() {
            let query = document.getElementById('search').value.toLowerCase();
            let res = await fetch('http://localhost:5000/students');
            let students = await res.json();
            let filteredStudents = students.filter(s => s.name.toLowerCase().includes(query));
            displayStudents(filteredStudents);
        }
        
        fetchStudents();
    </script>
</head>
<body>
    <img src="student.png" alt="student" width="300">
    <h1>Student List</h1>
    <h2>ป้อนชื่อ-สกุล เพื่อค้นหารายชื่อ</h2>
    <input type="text" id="search" placeholder="Search by name">
    <button onclick="searchStudent()">Search</button>
    <p id="noResults" style="color: red;"></p>
    <ul id="studentList"></ul>
    
    <h2>Add/Edit Student</h2>
    <input type="text" id="name" placeholder="Name">
    <input type="number" id="age" placeholder="Age">
    <input type="text" id="major" placeholder="Major">
    <button id="submitBtn" onclick="addStudent()">Submit</button>
</body>
</html>
