<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Management</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
    <script>
        
        async function fetchStudents() {
            let res = await fetch('http://localhost:5000/students');
            let students = await res.json();
            displayStudents(students);
        }

        
        function displayStudents(students) {
            let studentList = document.getElementById('studentList');
            let message = document.getElementById('noResults');
            
            if (students.length === 0) {
                studentList.innerHTML = '';
                message.textContent = 'ไม่มีข้อมูล';
            } else {
                studentList.innerHTML = students.map(s => 
                    `<li>
                        ${s.name} - ${s.major} 
                        <button onclick="editStudent('${s._id}', '${s.name}', ${s.age}, '${s.major}')">Edit</button>
                        <button onclick="deleteStudent('${s._id}')">Delete</button>
                    </li>`).join('');
                message.textContent = '';
            }
        }

        
        async function addStudent() {
            let name = document.getElementById('name').value;
            let age = document.getElementById('age').value;
            let major = document.getElementById('major').value;
            
            await fetch('http://localhost:5000/students', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, age, major })
            });
            
            fetchStudents();
        }

        
        function editStudent(id, name, age, major) {
            document.getElementById('name').value = name;
            document.getElementById('age').value = age;
            document.getElementById('major').value = major;
            document.getElementById('submitBtn').setAttribute('onclick', `updateStudent('${id}')`);
        }

        
        async function updateStudent(id) {
            let name = document.getElementById('name').value;
            let age = document.getElementById('age').value;
            let major = document.getElementById('major').value;
            
            await fetch(`http://localhost:5000/students/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, age, major })
            });
            
            fetchStudents();
        }

        
        async function searchStudent() {
            let query = document.getElementById('search').value.toLowerCase();
            
            
            if (!query) {
                alert("กรุณากรอกข้อมูล ชื่อ - นามสกุล");
                return;
            }
            
            let res = await fetch('http://localhost:5000/students');
            let students = await res.json();
            let filteredStudents = students.filter(s => s.name.toLowerCase().includes(query));
            displayStudents(filteredStudents);
        }

        
        async function deleteStudent(id) {
            await fetch(`http://localhost:5000/students/${id}`, {
                method: 'DELETE'
            });
            fetchStudents(); 
        }

        fetchStudents(); 
    </script>
</head>
<body>
    <header>
        <h1>Student Management System</h1>
    </header>

    <div class="container">
        <div class="search-container">
            <input type="text" id="search" placeholder="Search by name" required />
            <button onclick="searchStudent()">Search</button>
        </div>
        <p id="noResults" class="no-results"></p>
        
        <ul id="studentList"></ul>

        <h2>Add/Edit Student</h2>
        <div class="form-container">
            <input type="text" id="name" placeholder="Name" required>
            <input type="number" id="age" placeholder="Age" required>
            <input type="text" id="major" placeholder="Major" required>
            <button id="submitBtn" onclick="addStudent()">Submit</button>
        </div>
    </div>
</body>
</html>
